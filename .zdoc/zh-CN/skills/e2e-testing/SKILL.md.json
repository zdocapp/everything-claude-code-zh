{
  "sourceFile": "skills/e2e-testing/SKILL.md",
  "sourceLanguage": "en-US",
  "entries": [
    {
      "en-US": "---\nname: e2e-testing\ndescription: Playwright E2E testing patterns, Page Object Model, configuration, CI/CD integration, artifact management, and flaky test strategies.\norigin: ECC\n---",
      "zh-Hans": "---\nname: e2e-testing\ndescription: Playwright E2E 测试模式、页面对象模型、配置、CI/CD 集成、工件管理和不稳定测试策略。\norigin: ECC\n---"
    },
    {
      "en-US": "# E2E Testing Patterns",
      "zh-Hans": "# E2E 测试模式"
    },
    {
      "en-US": "Comprehensive Playwright patterns for building stable, fast, and maintainable E2E test suites.",
      "zh-Hans": "用于构建稳定、快速且可维护的 E2E 测试套件的全面 Playwright 模式。"
    },
    {
      "en-US": "## Test File Organization",
      "zh-Hans": "## 测试文件组织"
    },
    {
      "en-US": "```\ntests/\n├── e2e/\n│   ├── auth/\n│   │   ├── login.spec.ts\n│   │   ├── logout.spec.ts\n│   │   └── register.spec.ts\n│   ├── features/\n│   │   ├── browse.spec.ts\n│   │   ├── search.spec.ts\n│   │   └── create.spec.ts\n│   └── api/\n│       └── endpoints.spec.ts\n├── fixtures/\n│   ├── auth.ts\n│   └── data.ts\n└── playwright.config.ts\n```",
      "zh-Hans": "```\ntests/\n├── e2e/\n│   ├── auth/\n│   │   ├── login.spec.ts\n│   │   ├── logout.spec.ts\n│   │   └── register.spec.ts\n│   ├── features/\n│   │   ├── browse.spec.ts\n│   │   ├── search.spec.ts\n│   │   └── create.spec.ts\n│   └── api/\n│       └── endpoints.spec.ts\n├── fixtures/\n│   ├── auth.ts\n│   └── data.ts\n└── playwright.config.ts\n```"
    },
    {
      "en-US": "## Page Object Model (POM)",
      "zh-Hans": "## 页面对象模型 (POM)"
    },
    {
      "en-US": "```typescript\nimport { Page, Locator } from '@playwright/test'\n\nexport class ItemsPage {\n  readonly page: Page\n  readonly searchInput: Locator\n  readonly itemCards: Locator\n  readonly createButton: Locator\n\n  constructor(page: Page) {\n    this.page = page\n    this.searchInput = page.locator('[data-testid=\"search-input\"]')\n    this.itemCards = page.locator('[data-testid=\"item-card\"]')\n    this.createButton = page.locator('[data-testid=\"create-btn\"]')\n  }\n\n  async goto() {\n    await this.page.goto('/items')\n    await this.page.waitForLoadState('networkidle')\n  }\n\n  async search(query: string) {\n    await this.searchInput.fill(query)\n    await this.page.waitForResponse(resp => resp.url().includes('/api/search'))\n    await this.page.waitForLoadState('networkidle')\n  }\n\n  async getItemCount() {\n    return await this.itemCards.count()\n  }\n}\n```",
      "zh-Hans": "```typescript\nimport { Page, Locator } from '@playwright/test'\n\nexport class ItemsPage {\n  readonly page: Page\n  readonly searchInput: Locator\n  readonly itemCards: Locator\n  readonly createButton: Locator\n\n  constructor(page: Page) {\n    this.page = page\n    this.searchInput = page.locator('[data-testid=\"search-input\"]')\n    this.itemCards = page.locator('[data-testid=\"item-card\"]')\n    this.createButton = page.locator('[data-testid=\"create-btn\"]')\n  }\n\n  async goto() {\n    await this.page.goto('/items')\n    await this.page.waitForLoadState('networkidle')\n  }\n\n  async search(query: string) {\n    await this.searchInput.fill(query)\n    await this.page.waitForResponse(resp => resp.url().includes('/api/search'))\n    await this.page.waitForLoadState('networkidle')\n  }\n\n  async getItemCount() {\n    return await this.itemCards.count()\n  }\n}\n```"
    },
    {
      "en-US": "## Test Structure",
      "zh-Hans": "## 测试结构"
    },
    {
      "en-US": "```typescript\nimport { test, expect } from '@playwright/test'\nimport { ItemsPage } from '../../pages/ItemsPage'\n\ntest.describe('Item Search', () => {\n  let itemsPage: ItemsPage\n\n  test.beforeEach(async ({ page }) => {\n    itemsPage = new ItemsPage(page)\n    await itemsPage.goto()\n  })\n\n  test('should search by keyword', async ({ page }) => {\n    await itemsPage.search('test')\n\n    const count = await itemsPage.getItemCount()\n    expect(count).toBeGreaterThan(0)\n\n    await expect(itemsPage.itemCards.first()).toContainText(/test/i)\n    await page.screenshot({ path: 'artifacts/search-results.png' })\n  })\n\n  test('should handle no results', async ({ page }) => {\n    await itemsPage.search('xyznonexistent123')\n\n    await expect(page.locator('[data-testid=\"no-results\"]')).toBeVisible()\n    expect(await itemsPage.getItemCount()).toBe(0)\n  })\n})\n```",
      "zh-Hans": "```typescript\nimport { test, expect } from '@playwright/test'\nimport { ItemsPage } from '../../pages/ItemsPage'\n\ntest.describe('Item Search', () => {\n  let itemsPage: ItemsPage\n\n  test.beforeEach(async ({ page }) => {\n    itemsPage = new ItemsPage(page)\n    await itemsPage.goto()\n  })\n\n  test('should search by keyword', async ({ page }) => {\n    await itemsPage.search('test')\n\n    const count = await itemsPage.getItemCount()\n    expect(count).toBeGreaterThan(0)\n\n    await expect(itemsPage.itemCards.first()).toContainText(/test/i)\n    await page.screenshot({ path: 'artifacts/search-results.png' })\n  })\n\n  test('should handle no results', async ({ page }) => {\n    await itemsPage.search('xyznonexistent123')\n\n    await expect(page.locator('[data-testid=\"no-results\"]')).toBeVisible()\n    expect(await itemsPage.getItemCount()).toBe(0)\n  })\n})\n```"
    },
    {
      "en-US": "## Playwright Configuration",
      "zh-Hans": "## Playwright 配置"
    },
    {
      "en-US": "```typescript\nimport { defineConfig, devices } from '@playwright/test'\n\nexport default defineConfig({\n  testDir: './tests/e2e',\n  fullyParallel: true,\n  forbidOnly: !!process.env.CI,\n  retries: process.env.CI ? 2 : 0,\n  workers: process.env.CI ? 1 : undefined,\n  reporter: [\n    ['html', { outputFolder: 'playwright-report' }],\n    ['junit', { outputFile: 'playwright-results.xml' }],\n    ['json', { outputFile: 'playwright-results.json' }]\n  ],\n  use: {\n    baseURL: process.env.BASE_URL || 'http://localhost:3000',\n    trace: 'on-first-retry',\n    screenshot: 'only-on-failure',\n    video: 'retain-on-failure',\n    actionTimeout: 10000,\n    navigationTimeout: 30000,\n  },\n  projects: [\n    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },\n    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },\n    { name: 'webkit', use: { ...devices['Desktop Safari'] } },\n    { name: 'mobile-chrome', use: { ...devices['Pixel 5'] } },\n  ],\n  webServer: {\n    command: 'npm run dev',\n    url: 'http://localhost:3000',\n    reuseExistingServer: !process.env.CI,\n    timeout: 120000,\n  },\n})\n```",
      "zh-Hans": "```typescript\nimport { defineConfig, devices } from '@playwright/test'\n\nexport default defineConfig({\n  testDir: './tests/e2e',\n  fullyParallel: true,\n  forbidOnly: !!process.env.CI,\n  retries: process.env.CI ? 2 : 0,\n  workers: process.env.CI ? 1 : undefined,\n  reporter: [\n    ['html', { outputFolder: 'playwright-report' }],\n    ['junit', { outputFile: 'playwright-results.xml' }],\n    ['json', { outputFile: 'playwright-results.json' }]\n  ],\n  use: {\n    baseURL: process.env.BASE_URL || 'http://localhost:3000',\n    trace: 'on-first-retry',\n    screenshot: 'only-on-failure',\n    video: 'retain-on-failure',\n    actionTimeout: 10000,\n    navigationTimeout: 30000,\n  },\n  projects: [\n    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },\n    { name: 'firefox', use: { ...devices['Desktop Firefox'] } },\n    { name: 'webkit', use: { ...devices['Desktop Safari'] } },\n    { name: 'mobile-chrome', use: { ...devices['Pixel 5'] } },\n  ],\n  webServer: {\n    command: 'npm run dev',\n    url: 'http://localhost:3000',\n    reuseExistingServer: !process.env.CI,\n    timeout: 120000,\n  },\n})\n```"
    },
    {
      "en-US": "## Flaky Test Patterns",
      "zh-Hans": "## 不稳定测试模式"
    },
    {
      "en-US": "### Quarantine",
      "zh-Hans": "### 隔离"
    },
    {
      "en-US": "```typescript\ntest('flaky: complex search', async ({ page }) => {\n  test.fixme(true, 'Flaky - Issue #123')\n  // test code...\n})\n\ntest('conditional skip', async ({ page }) => {\n  test.skip(process.env.CI, 'Flaky in CI - Issue #123')\n  // test code...\n})\n```",
      "zh-Hans": "```typescript\ntest('flaky: complex search', async ({ page }) => {\n  test.fixme(true, 'Flaky - Issue #123')\n  // test code...\n})\n\ntest('conditional skip', async ({ page }) => {\n  test.skip(process.env.CI, 'Flaky in CI - Issue #123')\n  // test code...\n})\n```"
    },
    {
      "en-US": "### Identify Flakiness",
      "zh-Hans": "### 识别不稳定性"
    },
    {
      "en-US": "```bash\nnpx playwright test tests/search.spec.ts --repeat-each=10\nnpx playwright test tests/search.spec.ts --retries=3\n```",
      "zh-Hans": "```bash\nnpx playwright test tests/search.spec.ts --repeat-each=10\nnpx playwright test tests/search.spec.ts --retries=3\n```"
    },
    {
      "en-US": "### Common Causes & Fixes",
      "zh-Hans": "### 常见原因与修复"
    },
    {
      "en-US": "**Race conditions:**",
      "zh-Hans": "**竞态条件：**"
    },
    {
      "en-US": "```typescript\n// Bad: assumes element is ready\nawait page.click('[data-testid=\"button\"]')\n\n// Good: auto-wait locator\nawait page.locator('[data-testid=\"button\"]').click()\n```",
      "zh-Hans": "```typescript\n// Bad: assumes element is ready\nawait page.click('[data-testid=\"button\"]')\n\n// Good: auto-wait locator\nawait page.locator('[data-testid=\"button\"]').click()\n```"
    },
    {
      "en-US": "**Network timing:**",
      "zh-Hans": "**网络时序：**"
    },
    {
      "en-US": "```typescript\n// Bad: arbitrary timeout\nawait page.waitForTimeout(5000)\n\n// Good: wait for specific condition\nawait page.waitForResponse(resp => resp.url().includes('/api/data'))\n```",
      "zh-Hans": "```typescript\n// Bad: arbitrary timeout\nawait page.waitForTimeout(5000)\n\n// Good: wait for specific condition\nawait page.waitForResponse(resp => resp.url().includes('/api/data'))\n```"
    },
    {
      "en-US": "**Animation timing:**",
      "zh-Hans": "**动画时序：**"
    },
    {
      "en-US": "```typescript\n// Bad: click during animation\nawait page.click('[data-testid=\"menu-item\"]')\n\n// Good: wait for stability\nawait page.locator('[data-testid=\"menu-item\"]').waitFor({ state: 'visible' })\nawait page.waitForLoadState('networkidle')\nawait page.locator('[data-testid=\"menu-item\"]').click()\n```",
      "zh-Hans": "```typescript\n// Bad: click during animation\nawait page.click('[data-testid=\"menu-item\"]')\n\n// Good: wait for stability\nawait page.locator('[data-testid=\"menu-item\"]').waitFor({ state: 'visible' })\nawait page.waitForLoadState('networkidle')\nawait page.locator('[data-testid=\"menu-item\"]').click()\n```"
    },
    {
      "en-US": "## Artifact Management",
      "zh-Hans": "## 产物管理"
    },
    {
      "en-US": "### Screenshots",
      "zh-Hans": "### 截图"
    },
    {
      "en-US": "```typescript\nawait page.screenshot({ path: 'artifacts/after-login.png' })\nawait page.screenshot({ path: 'artifacts/full-page.png', fullPage: true })\nawait page.locator('[data-testid=\"chart\"]').screenshot({ path: 'artifacts/chart.png' })\n```",
      "zh-Hans": "```typescript\nawait page.screenshot({ path: 'artifacts/after-login.png' })\nawait page.screenshot({ path: 'artifacts/full-page.png', fullPage: true })\nawait page.locator('[data-testid=\"chart\"]').screenshot({ path: 'artifacts/chart.png' })\n```"
    },
    {
      "en-US": "### Traces",
      "zh-Hans": "### 跟踪记录"
    },
    {
      "en-US": "```typescript\nawait browser.startTracing(page, {\n  path: 'artifacts/trace.json',\n  screenshots: true,\n  snapshots: true,\n})\n// ... test actions ...\nawait browser.stopTracing()\n```",
      "zh-Hans": "```typescript\nawait browser.startTracing(page, {\n  path: 'artifacts/trace.json',\n  screenshots: true,\n  snapshots: true,\n})\n// ... test actions ...\nawait browser.stopTracing()\n```"
    },
    {
      "en-US": "### Video",
      "zh-Hans": "### 视频"
    },
    {
      "en-US": "```typescript\n// In playwright.config.ts\nuse: {\n  video: 'retain-on-failure',\n  videosPath: 'artifacts/videos/'\n}\n```",
      "zh-Hans": "```typescript\n// In playwright.config.ts\nuse: {\n  video: 'retain-on-failure',\n  videosPath: 'artifacts/videos/'\n}\n```"
    },
    {
      "en-US": "## CI/CD Integration",
      "zh-Hans": "## CI/CD 集成"
    },
    {
      "en-US": "```yaml\n# .github/workflows/e2e.yml\nname: E2E Tests\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: 20\n      - run: npm ci\n      - run: npx playwright install --with-deps\n      - run: npx playwright test\n        env:\n          BASE_URL: ${{ vars.STAGING_URL }}\n      - uses: actions/upload-artifact@v4\n        if: always()\n        with:\n          name: playwright-report\n          path: playwright-report/\n          retention-days: 30\n```",
      "zh-Hans": "```yaml\n# .github/workflows/e2e.yml\nname: E2E Tests\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: 20\n      - run: npm ci\n      - run: npx playwright install --with-deps\n      - run: npx playwright test\n        env:\n          BASE_URL: ${{ vars.STAGING_URL }}\n      - uses: actions/upload-artifact@v4\n        if: always()\n        with:\n          name: playwright-report\n          path: playwright-report/\n          retention-days: 30\n```"
    },
    {
      "en-US": "## Test Report Template",
      "zh-Hans": "## 测试报告模板"
    },
    {
      "en-US": "```markdown\n# E2E Test Report\n\n**Date:** YYYY-MM-DD HH:MM\n**Duration:** Xm Ys\n**Status:** PASSING / FAILING\n\n## Summary\n- Total: X | Passed: Y (Z%) | Failed: A | Flaky: B | Skipped: C\n\n## Failed Tests\n\n### test-name\n**File:** `tests/e2e/feature.spec.ts:45`\n**Error:** Expected element to be visible\n**Screenshot:** artifacts/failed.png\n**Recommended Fix:** [description]\n\n## Artifacts\n- HTML Report: playwright-report/index.html\n- Screenshots: artifacts/*.png\n- Videos: artifacts/videos/*.webm\n- Traces: artifacts/*.zip\n```",
      "zh-Hans": "```markdown\n# E2E 测试报告\n\n**日期：** YYYY-MM-DD HH:MM\n**持续时间：** Xm Ys\n**状态：** 通过 / 失败\n\n## 概要\n- 总计：X | 通过：Y (Z%) | 失败：A | 不稳定：B | 跳过：C\n\n## 失败的测试\n\n### test-name\n**文件：** `tests/e2e/feature.spec.ts:45`\n**错误：** 期望元素可见\n**截图：** artifacts/failed.png\n**建议修复：** [description]\n\n## 产物\n- HTML 报告：playwright-report/index.html\n- 截图：artifacts/*.png\n- 视频：artifacts/videos/*.webm\n- 追踪文件：artifacts/*.zip\n```"
    },
    {
      "en-US": "## Wallet / Web3 Testing",
      "zh-Hans": "## 钱包 / Web3 测试"
    },
    {
      "en-US": "```typescript\ntest('wallet connection', async ({ page, context }) => {\n  // Mock wallet provider\n  await context.addInitScript(() => {\n    window.ethereum = {\n      isMetaMask: true,\n      request: async ({ method }) => {\n        if (method === 'eth_requestAccounts')\n          return ['0x1234567890123456789012345678901234567890']\n        if (method === 'eth_chainId') return '0x1'\n      }\n    }\n  })\n\n  await page.goto('/')\n  await page.locator('[data-testid=\"connect-wallet\"]').click()\n  await expect(page.locator('[data-testid=\"wallet-address\"]')).toContainText('0x1234')\n})\n```",
      "zh-Hans": "```typescript\ntest('wallet connection', async ({ page, context }) => {\n  // Mock wallet provider\n  await context.addInitScript(() => {\n    window.ethereum = {\n      isMetaMask: true,\n      request: async ({ method }) => {\n        if (method === 'eth_requestAccounts')\n          return ['0x1234567890123456789012345678901234567890']\n        if (method === 'eth_chainId') return '0x1'\n      }\n    }\n  })\n\n  await page.goto('/')\n  await page.locator('[data-testid=\"connect-wallet\"]').click()\n  await expect(page.locator('[data-testid=\"wallet-address\"]')).toContainText('0x1234')\n})\n```"
    },
    {
      "en-US": "## Financial / Critical Flow Testing",
      "zh-Hans": "## 金融 / 关键流程测试"
    },
    {
      "en-US": "```typescript\ntest('trade execution', async ({ page }) => {\n  // Skip on production — real money\n  test.skip(process.env.NODE_ENV === 'production', 'Skip on production')\n\n  await page.goto('/markets/test-market')\n  await page.locator('[data-testid=\"position-yes\"]').click()\n  await page.locator('[data-testid=\"trade-amount\"]').fill('1.0')\n\n  // Verify preview\n  const preview = page.locator('[data-testid=\"trade-preview\"]')\n  await expect(preview).toContainText('1.0')\n\n  // Confirm and wait for blockchain\n  await page.locator('[data-testid=\"confirm-trade\"]').click()\n  await page.waitForResponse(\n    resp => resp.url().includes('/api/trade') && resp.status() === 200,\n    { timeout: 30000 }\n  )\n\n  await expect(page.locator('[data-testid=\"trade-success\"]')).toBeVisible()\n})\n```",
      "zh-Hans": "```typescript\ntest('trade execution', async ({ page }) => {\n  // Skip on production — real money\n  test.skip(process.env.NODE_ENV === 'production', 'Skip on production')\n\n  await page.goto('/markets/test-market')\n  await page.locator('[data-testid=\"position-yes\"]').click()\n  await page.locator('[data-testid=\"trade-amount\"]').fill('1.0')\n\n  // Verify preview\n  const preview = page.locator('[data-testid=\"trade-preview\"]')\n  await expect(preview).toContainText('1.0')\n\n  // Confirm and wait for blockchain\n  await page.locator('[data-testid=\"confirm-trade\"]').click()\n  await page.waitForResponse(\n    resp => resp.url().includes('/api/trade') && resp.status() === 200,\n    { timeout: 30000 }\n  )\n\n  await expect(page.locator('[data-testid=\"trade-success\"]')).toBeVisible()\n})\n```"
    }
  ]
}
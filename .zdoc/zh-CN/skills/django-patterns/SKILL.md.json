{
  "sourceFile": "skills/django-patterns/SKILL.md",
  "sourceLanguage": "en-US",
  "entries": [
    {
      "en-US": "---\nname: django-patterns\ndescription: Django architecture patterns, REST API design with DRF, ORM best practices, caching, signals, middleware, and production-grade Django apps.\norigin: ECC\n---",
      "zh-Hans": "---\nname: django-patterns\ndescription: Django架构模式，使用DRF设计REST API，ORM最佳实践，缓存，信号，中间件，以及生产级Django应用程序。\norigin: ECC\n---"
    },
    {
      "en-US": "# Django Development Patterns",
      "zh-Hans": "# Django 开发模式"
    },
    {
      "en-US": "Production-grade Django architecture patterns for scalable, maintainable applications.",
      "zh-Hans": "适用于可扩展、可维护应用程序的生产级 Django 架构模式。"
    },
    {
      "en-US": "## When to Activate",
      "zh-Hans": "## 何时激活"
    },
    {
      "en-US": "- Building Django web applications\n- Designing Django REST Framework APIs\n- Working with Django ORM and models\n- Setting up Django project structure\n- Implementing caching, signals, middleware",
      "zh-Hans": "* 构建 Django Web 应用程序时\n* 设计 Django REST Framework API 时\n* 使用 Django ORM 和模型时\n* 设置 Django 项目结构时\n* 实现缓存、信号、中间件时"
    },
    {
      "en-US": "## Project Structure",
      "zh-Hans": "## 项目结构"
    },
    {
      "en-US": "### Recommended Layout",
      "zh-Hans": "### 推荐布局"
    },
    {
      "en-US": "```\nmyproject/\n├── config/\n│   ├── __init__.py\n│   ├── settings/\n│   │   ├── __init__.py\n│   │   ├── base.py          # Base settings\n│   │   ├── development.py   # Dev settings\n│   │   ├── production.py    # Production settings\n│   │   └── test.py          # Test settings\n│   ├── urls.py\n│   ├── wsgi.py\n│   └── asgi.py\n├── manage.py\n└── apps/\n    ├── __init__.py\n    ├── users/\n    │   ├── __init__.py\n    │   ├── models.py\n    │   ├── views.py\n    │   ├── serializers.py\n    │   ├── urls.py\n    │   ├── permissions.py\n    │   ├── filters.py\n    │   ├── services.py\n    │   └── tests/\n    └── products/\n        └── ...\n```",
      "zh-Hans": "```\nmyproject/\n├── config/\n│   ├── __init__.py\n│   ├── settings/\n│   │   ├── __init__.py\n│   │   ├── base.py          # Base settings\n│   │   ├── development.py   # Dev settings\n│   │   ├── production.py    # Production settings\n│   │   └── test.py          # Test settings\n│   ├── urls.py\n│   ├── wsgi.py\n│   └── asgi.py\n├── manage.py\n└── apps/\n    ├── __init__.py\n    ├── users/\n    │   ├── __init__.py\n    │   ├── models.py\n    │   ├── views.py\n    │   ├── serializers.py\n    │   ├── urls.py\n    │   ├── permissions.py\n    │   ├── filters.py\n    │   ├── services.py\n    │   └── tests/\n    └── products/\n        └── ...\n```"
    },
    {
      "en-US": "### Split Settings Pattern",
      "zh-Hans": "### 拆分设置模式"
    },
    {
      "en-US": "```python\n# config/settings/base.py\nfrom pathlib import Path\n\nBASE_DIR = Path(__file__).resolve().parent.parent.parent\n\nSECRET_KEY = env('DJANGO_SECRET_KEY')\nDEBUG = False\nALLOWED_HOSTS = []\n\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'rest_framework',\n    'rest_framework.authtoken',\n    'corsheaders',\n    # Local apps\n    'apps.users',\n    'apps.products',\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'whitenoise.middleware.WhiteNoiseMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'corsheaders.middleware.CorsMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\n]\n\nROOT_URLCONF = 'config.urls'\nWSGI_APPLICATION = 'config.wsgi.application'\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql',\n        'NAME': env('DB_NAME'),\n        'USER': env('DB_USER'),\n        'PASSWORD': env('DB_PASSWORD'),\n        'HOST': env('DB_HOST'),\n        'PORT': env('DB_PORT', default='5432'),\n    }\n}\n\n# config/settings/development.py\nfrom .base import *\n\nDEBUG = True\nALLOWED_HOSTS = ['localhost', '127.0.0.1']\n\nDATABASES['default']['NAME'] = 'myproject_dev'\n\nINSTALLED_APPS += ['debug_toolbar']\n\nMIDDLEWARE += ['debug_toolbar.middleware.DebugToolbarMiddleware']\n\nEMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'\n\n# config/settings/production.py\nfrom .base import *\n\nDEBUG = False\nALLOWED_HOSTS = env.list('ALLOWED_HOSTS')\nSECURE_SSL_REDIRECT = True\nSESSION_COOKIE_SECURE = True\nCSRF_COOKIE_SECURE = True\nSECURE_HSTS_SECONDS = 31536000\nSECURE_HSTS_INCLUDE_SUBDOMAINS = True\nSECURE_HSTS_PRELOAD = True\n\n# Logging\nLOGGING = {\n    'version': 1,\n    'disable_existing_loggers': False,\n    'handlers': {\n        'file': {\n            'level': 'WARNING',\n            'class': 'logging.FileHandler',\n            'filename': '/var/log/django/django.log',\n        },\n    },\n    'loggers': {\n        'django': {\n            'handlers': ['file'],\n            'level': 'WARNING',\n            'propagate': True,\n        },\n    },\n}\n```",
      "zh-Hans": "```python\n# config/settings/base.py\nfrom pathlib import Path\n\nBASE_DIR = Path(__file__).resolve().parent.parent.parent\n\nSECRET_KEY = env('DJANGO_SECRET_KEY')\nDEBUG = False\nALLOWED_HOSTS = []\n\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'rest_framework',\n    'rest_framework.authtoken',\n    'corsheaders',\n    # Local apps\n    'apps.users',\n    'apps.products',\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'whitenoise.middleware.WhiteNoiseMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'corsheaders.middleware.CorsMiddleware',\n    'django.middleware.common.CommonMiddleware',\n    'django.middleware.csrf.CsrfViewMiddleware',\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\n    'django.contrib.messages.middleware.MessageMiddleware',\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\n]\n\nROOT_URLCONF = 'config.urls'\nWSGI_APPLICATION = 'config.wsgi.application'\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql',\n        'NAME': env('DB_NAME'),\n        'USER': env('DB_USER'),\n        'PASSWORD': env('DB_PASSWORD'),\n        'HOST': env('DB_HOST'),\n        'PORT': env('DB_PORT', default='5432'),\n    }\n}\n\n# config/settings/development.py\nfrom .base import *\n\nDEBUG = True\nALLOWED_HOSTS = ['localhost', '127.0.0.1']\n\nDATABASES['default']['NAME'] = 'myproject_dev'\n\nINSTALLED_APPS += ['debug_toolbar']\n\nMIDDLEWARE += ['debug_toolbar.middleware.DebugToolbarMiddleware']\n\nEMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'\n\n# config/settings/production.py\nfrom .base import *\n\nDEBUG = False\nALLOWED_HOSTS = env.list('ALLOWED_HOSTS')\nSECURE_SSL_REDIRECT = True\nSESSION_COOKIE_SECURE = True\nCSRF_COOKIE_SECURE = True\nSECURE_HSTS_SECONDS = 31536000\nSECURE_HSTS_INCLUDE_SUBDOMAINS = True\nSECURE_HSTS_PRELOAD = True\n\n# Logging\nLOGGING = {\n    'version': 1,\n    'disable_existing_loggers': False,\n    'handlers': {\n        'file': {\n            'level': 'WARNING',\n            'class': 'logging.FileHandler',\n            'filename': '/var/log/django/django.log',\n        },\n    },\n    'loggers': {\n        'django': {\n            'handlers': ['file'],\n            'level': 'WARNING',\n            'propagate': True,\n        },\n    },\n}\n```"
    },
    {
      "en-US": "## Model Design Patterns",
      "zh-Hans": "## 模型设计模式"
    },
    {
      "en-US": "### Model Best Practices",
      "zh-Hans": "### 模型最佳实践"
    },
    {
      "en-US": "```python\nfrom django.db import models\nfrom django.contrib.auth.models import AbstractUser\nfrom django.core.validators import MinValueValidator, MaxValueValidator\n\nclass User(AbstractUser):\n    \"\"\"Custom user model extending AbstractUser.\"\"\"\n    email = models.EmailField(unique=True)\n    phone = models.CharField(max_length=20, blank=True)\n    birth_date = models.DateField(null=True, blank=True)\n\n    USERNAME_FIELD = 'email'\n    REQUIRED_FIELDS = ['username']\n\n    class Meta:\n        db_table = 'users'\n        verbose_name = 'user'\n        verbose_name_plural = 'users'\n        ordering = ['-date_joined']\n\n    def __str__(self):\n        return self.email\n\n    def get_full_name(self):\n        return f\"{self.first_name} {self.last_name}\".strip()\n\nclass Product(models.Model):\n    \"\"\"Product model with proper field configuration.\"\"\"\n    name = models.CharField(max_length=200)\n    slug = models.SlugField(unique=True, max_length=250)\n    description = models.TextField(blank=True)\n    price = models.DecimalField(\n        max_digits=10,\n        decimal_places=2,\n        validators=[MinValueValidator(0)]\n    )\n    stock = models.PositiveIntegerField(default=0)\n    is_active = models.BooleanField(default=True)\n    category = models.ForeignKey(\n        'Category',\n        on_delete=models.CASCADE,\n        related_name='products'\n    )\n    tags = models.ManyToManyField('Tag', blank=True, related_name='products')\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n\n    class Meta:\n        db_table = 'products'\n        ordering = ['-created_at']\n        indexes = [\n            models.Index(fields=['slug']),\n            models.Index(fields=['-created_at']),\n            models.Index(fields=['category', 'is_active']),\n        ]\n        constraints = [\n            models.CheckConstraint(\n                check=models.Q(price__gte=0),\n                name='price_non_negative'\n            )\n        ]\n\n    def __str__(self):\n        return self.name\n\n    def save(self, *args, **kwargs):\n        if not self.slug:\n            self.slug = slugify(self.name)\n        super().save(*args, **kwargs)\n```",
      "zh-Hans": "```python\nfrom django.db import models\nfrom django.contrib.auth.models import AbstractUser\nfrom django.core.validators import MinValueValidator, MaxValueValidator\n\nclass User(AbstractUser):\n    \"\"\"Custom user model extending AbstractUser.\"\"\"\n    email = models.EmailField(unique=True)\n    phone = models.CharField(max_length=20, blank=True)\n    birth_date = models.DateField(null=True, blank=True)\n\n    USERNAME_FIELD = 'email'\n    REQUIRED_FIELDS = ['username']\n\n    class Meta:\n        db_table = 'users'\n        verbose_name = 'user'\n        verbose_name_plural = 'users'\n        ordering = ['-date_joined']\n\n    def __str__(self):\n        return self.email\n\n    def get_full_name(self):\n        return f\"{self.first_name} {self.last_name}\".strip()\n\nclass Product(models.Model):\n    \"\"\"Product model with proper field configuration.\"\"\"\n    name = models.CharField(max_length=200)\n    slug = models.SlugField(unique=True, max_length=250)\n    description = models.TextField(blank=True)\n    price = models.DecimalField(\n        max_digits=10,\n        decimal_places=2,\n        validators=[MinValueValidator(0)]\n    )\n    stock = models.PositiveIntegerField(default=0)\n    is_active = models.BooleanField(default=True)\n    category = models.ForeignKey(\n        'Category',\n        on_delete=models.CASCADE,\n        related_name='products'\n    )\n    tags = models.ManyToManyField('Tag', blank=True, related_name='products')\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n\n    class Meta:\n        db_table = 'products'\n        ordering = ['-created_at']\n        indexes = [\n            models.Index(fields=['slug']),\n            models.Index(fields=['-created_at']),\n            models.Index(fields=['category', 'is_active']),\n        ]\n        constraints = [\n            models.CheckConstraint(\n                check=models.Q(price__gte=0),\n                name='price_non_negative'\n            )\n        ]\n\n    def __str__(self):\n        return self.name\n\n    def save(self, *args, **kwargs):\n        if not self.slug:\n            self.slug = slugify(self.name)\n        super().save(*args, **kwargs)\n```"
    },
    {
      "en-US": "### QuerySet Best Practices",
      "zh-Hans": "### QuerySet 最佳实践"
    },
    {
      "en-US": "```python\nfrom django.db import models\n\nclass ProductQuerySet(models.QuerySet):\n    \"\"\"Custom QuerySet for Product model.\"\"\"\n\n    def active(self):\n        \"\"\"Return only active products.\"\"\"\n        return self.filter(is_active=True)\n\n    def with_category(self):\n        \"\"\"Select related category to avoid N+1 queries.\"\"\"\n        return self.select_related('category')\n\n    def with_tags(self):\n        \"\"\"Prefetch tags for many-to-many relationship.\"\"\"\n        return self.prefetch_related('tags')\n\n    def in_stock(self):\n        \"\"\"Return products with stock > 0.\"\"\"\n        return self.filter(stock__gt=0)\n\n    def search(self, query):\n        \"\"\"Search products by name or description.\"\"\"\n        return self.filter(\n            models.Q(name__icontains=query) |\n            models.Q(description__icontains=query)\n        )\n\nclass Product(models.Model):\n    # ... fields ...\n\n    objects = ProductQuerySet.as_manager()  # Use custom QuerySet\n\n# Usage\nProduct.objects.active().with_category().in_stock()\n```",
      "zh-Hans": "```python\nfrom django.db import models\n\nclass ProductQuerySet(models.QuerySet):\n    \"\"\"Custom QuerySet for Product model.\"\"\"\n\n    def active(self):\n        \"\"\"Return only active products.\"\"\"\n        return self.filter(is_active=True)\n\n    def with_category(self):\n        \"\"\"Select related category to avoid N+1 queries.\"\"\"\n        return self.select_related('category')\n\n    def with_tags(self):\n        \"\"\"Prefetch tags for many-to-many relationship.\"\"\"\n        return self.prefetch_related('tags')\n\n    def in_stock(self):\n        \"\"\"Return products with stock > 0.\"\"\"\n        return self.filter(stock__gt=0)\n\n    def search(self, query):\n        \"\"\"Search products by name or description.\"\"\"\n        return self.filter(\n            models.Q(name__icontains=query) |\n            models.Q(description__icontains=query)\n        )\n\nclass Product(models.Model):\n    # ... fields ...\n\n    objects = ProductQuerySet.as_manager()  # Use custom QuerySet\n\n# Usage\nProduct.objects.active().with_category().in_stock()\n```"
    },
    {
      "en-US": "### Manager Methods",
      "zh-Hans": "### 管理器方法"
    },
    {
      "en-US": "```python\nclass ProductManager(models.Manager):\n    \"\"\"Custom manager for complex queries.\"\"\"\n\n    def get_or_none(self, **kwargs):\n        \"\"\"Return object or None instead of DoesNotExist.\"\"\"\n        try:\n            return self.get(**kwargs)\n        except self.model.DoesNotExist:\n            return None\n\n    def create_with_tags(self, name, price, tag_names):\n        \"\"\"Create product with associated tags.\"\"\"\n        product = self.create(name=name, price=price)\n        tags = [Tag.objects.get_or_create(name=name)[0] for name in tag_names]\n        product.tags.set(tags)\n        return product\n\n    def bulk_update_stock(self, product_ids, quantity):\n        \"\"\"Bulk update stock for multiple products.\"\"\"\n        return self.filter(id__in=product_ids).update(stock=quantity)\n\n# In model\nclass Product(models.Model):\n    # ... fields ...\n    custom = ProductManager()\n```",
      "zh-Hans": "```python\nclass ProductManager(models.Manager):\n    \"\"\"Custom manager for complex queries.\"\"\"\n\n    def get_or_none(self, **kwargs):\n        \"\"\"Return object or None instead of DoesNotExist.\"\"\"\n        try:\n            return self.get(**kwargs)\n        except self.model.DoesNotExist:\n            return None\n\n    def create_with_tags(self, name, price, tag_names):\n        \"\"\"Create product with associated tags.\"\"\"\n        product = self.create(name=name, price=price)\n        tags = [Tag.objects.get_or_create(name=name)[0] for name in tag_names]\n        product.tags.set(tags)\n        return product\n\n    def bulk_update_stock(self, product_ids, quantity):\n        \"\"\"Bulk update stock for multiple products.\"\"\"\n        return self.filter(id__in=product_ids).update(stock=quantity)\n\n# In model\nclass Product(models.Model):\n    # ... fields ...\n    custom = ProductManager()\n```"
    },
    {
      "en-US": "## Django REST Framework Patterns",
      "zh-Hans": "## Django REST Framework 模式"
    },
    {
      "en-US": "### Serializer Patterns",
      "zh-Hans": "### 序列化器模式"
    },
    {
      "en-US": "```python\nfrom rest_framework import serializers\nfrom django.contrib.auth.password_validation import validate_password\nfrom .models import Product, User\n\nclass ProductSerializer(serializers.ModelSerializer):\n    \"\"\"Serializer for Product model.\"\"\"\n\n    category_name = serializers.CharField(source='category.name', read_only=True)\n    average_rating = serializers.FloatField(read_only=True)\n    discount_price = serializers.SerializerMethodField()\n\n    class Meta:\n        model = Product\n        fields = [\n            'id', 'name', 'slug', 'description', 'price',\n            'discount_price', 'stock', 'category_name',\n            'average_rating', 'created_at'\n        ]\n        read_only_fields = ['id', 'slug', 'created_at']\n\n    def get_discount_price(self, obj):\n        \"\"\"Calculate discount price if applicable.\"\"\"\n        if hasattr(obj, 'discount') and obj.discount:\n            return obj.price * (1 - obj.discount.percent / 100)\n        return obj.price\n\n    def validate_price(self, value):\n        \"\"\"Ensure price is non-negative.\"\"\"\n        if value < 0:\n            raise serializers.ValidationError(\"Price cannot be negative.\")\n        return value\n\nclass ProductCreateSerializer(serializers.ModelSerializer):\n    \"\"\"Serializer for creating products.\"\"\"\n\n    class Meta:\n        model = Product\n        fields = ['name', 'description', 'price', 'stock', 'category']\n\n    def validate(self, data):\n        \"\"\"Custom validation for multiple fields.\"\"\"\n        if data['price'] > 10000 and data['stock'] > 100:\n            raise serializers.ValidationError(\n                \"Cannot have high-value products with large stock.\"\n            )\n        return data\n\nclass UserRegistrationSerializer(serializers.ModelSerializer):\n    \"\"\"Serializer for user registration.\"\"\"\n\n    password = serializers.CharField(\n        write_only=True,\n        required=True,\n        validators=[validate_password],\n        style={'input_type': 'password'}\n    )\n    password_confirm = serializers.CharField(write_only=True, style={'input_type': 'password'})\n\n    class Meta:\n        model = User\n        fields = ['email', 'username', 'password', 'password_confirm']\n\n    def validate(self, data):\n        \"\"\"Validate passwords match.\"\"\"\n        if data['password'] != data['password_confirm']:\n            raise serializers.ValidationError({\n                \"password_confirm\": \"Password fields didn't match.\"\n            })\n        return data\n\n    def create(self, validated_data):\n        \"\"\"Create user with hashed password.\"\"\"\n        validated_data.pop('password_confirm')\n        password = validated_data.pop('password')\n        user = User.objects.create(**validated_data)\n        user.set_password(password)\n        user.save()\n        return user\n```",
      "zh-Hans": "```python\nfrom rest_framework import serializers\nfrom django.contrib.auth.password_validation import validate_password\nfrom .models import Product, User\n\nclass ProductSerializer(serializers.ModelSerializer):\n    \"\"\"Serializer for Product model.\"\"\"\n\n    category_name = serializers.CharField(source='category.name', read_only=True)\n    average_rating = serializers.FloatField(read_only=True)\n    discount_price = serializers.SerializerMethodField()\n\n    class Meta:\n        model = Product\n        fields = [\n            'id', 'name', 'slug', 'description', 'price',\n            'discount_price', 'stock', 'category_name',\n            'average_rating', 'created_at'\n        ]\n        read_only_fields = ['id', 'slug', 'created_at']\n\n    def get_discount_price(self, obj):\n        \"\"\"Calculate discount price if applicable.\"\"\"\n        if hasattr(obj, 'discount') and obj.discount:\n            return obj.price * (1 - obj.discount.percent / 100)\n        return obj.price\n\n    def validate_price(self, value):\n        \"\"\"Ensure price is non-negative.\"\"\"\n        if value < 0:\n            raise serializers.ValidationError(\"Price cannot be negative.\")\n        return value\n\nclass ProductCreateSerializer(serializers.ModelSerializer):\n    \"\"\"Serializer for creating products.\"\"\"\n\n    class Meta:\n        model = Product\n        fields = ['name', 'description', 'price', 'stock', 'category']\n\n    def validate(self, data):\n        \"\"\"Custom validation for multiple fields.\"\"\"\n        if data['price'] > 10000 and data['stock'] > 100:\n            raise serializers.ValidationError(\n                \"Cannot have high-value products with large stock.\"\n            )\n        return data\n\nclass UserRegistrationSerializer(serializers.ModelSerializer):\n    \"\"\"Serializer for user registration.\"\"\"\n\n    password = serializers.CharField(\n        write_only=True,\n        required=True,\n        validators=[validate_password],\n        style={'input_type': 'password'}\n    )\n    password_confirm = serializers.CharField(write_only=True, style={'input_type': 'password'})\n\n    class Meta:\n        model = User\n        fields = ['email', 'username', 'password', 'password_confirm']\n\n    def validate(self, data):\n        \"\"\"Validate passwords match.\"\"\"\n        if data['password'] != data['password_confirm']:\n            raise serializers.ValidationError({\n                \"password_confirm\": \"Password fields didn't match.\"\n            })\n        return data\n\n    def create(self, validated_data):\n        \"\"\"Create user with hashed password.\"\"\"\n        validated_data.pop('password_confirm')\n        password = validated_data.pop('password')\n        user = User.objects.create(**validated_data)\n        user.set_password(password)\n        user.save()\n        return user\n```"
    },
    {
      "en-US": "### ViewSet Patterns",
      "zh-Hans": "### ViewSet 模式"
    },
    {
      "en-US": "```python\nfrom rest_framework import viewsets, status, filters\nfrom rest_framework.decorators import action\nfrom rest_framework.response import Response\nfrom rest_framework.permissions import IsAuthenticated, IsAdminUser\nfrom django_filters.rest_framework import DjangoFilterBackend\nfrom .models import Product\nfrom .serializers import ProductSerializer, ProductCreateSerializer\nfrom .permissions import IsOwnerOrReadOnly\nfrom .filters import ProductFilter\nfrom .services import ProductService\n\nclass ProductViewSet(viewsets.ModelViewSet):\n    \"\"\"ViewSet for Product model.\"\"\"\n\n    queryset = Product.objects.select_related('category').prefetch_related('tags')\n    permission_classes = [IsAuthenticated, IsOwnerOrReadOnly]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_class = ProductFilter\n    search_fields = ['name', 'description']\n    ordering_fields = ['price', 'created_at', 'name']\n    ordering = ['-created_at']\n\n    def get_serializer_class(self):\n        \"\"\"Return appropriate serializer based on action.\"\"\"\n        if self.action == 'create':\n            return ProductCreateSerializer\n        return ProductSerializer\n\n    def perform_create(self, serializer):\n        \"\"\"Save with user context.\"\"\"\n        serializer.save(created_by=self.request.user)\n\n    @action(detail=False, methods=['get'])\n    def featured(self, request):\n        \"\"\"Return featured products.\"\"\"\n        featured = self.queryset.filter(is_featured=True)[:10]\n        serializer = self.get_serializer(featured, many=True)\n        return Response(serializer.data)\n\n    @action(detail=True, methods=['post'])\n    def purchase(self, request, pk=None):\n        \"\"\"Purchase a product.\"\"\"\n        product = self.get_object()\n        service = ProductService()\n        result = service.purchase(product, request.user)\n        return Response(result, status=status.HTTP_201_CREATED)\n\n    @action(detail=False, methods=['get'], permission_classes=[IsAuthenticated])\n    def my_products(self, request):\n        \"\"\"Return products created by current user.\"\"\"\n        products = self.queryset.filter(created_by=request.user)\n        page = self.paginate_queryset(products)\n        serializer = self.get_serializer(page, many=True)\n        return self.get_paginated_response(serializer.data)\n```",
      "zh-Hans": "```python\nfrom rest_framework import viewsets, status, filters\nfrom rest_framework.decorators import action\nfrom rest_framework.response import Response\nfrom rest_framework.permissions import IsAuthenticated, IsAdminUser\nfrom django_filters.rest_framework import DjangoFilterBackend\nfrom .models import Product\nfrom .serializers import ProductSerializer, ProductCreateSerializer\nfrom .permissions import IsOwnerOrReadOnly\nfrom .filters import ProductFilter\nfrom .services import ProductService\n\nclass ProductViewSet(viewsets.ModelViewSet):\n    \"\"\"ViewSet for Product model.\"\"\"\n\n    queryset = Product.objects.select_related('category').prefetch_related('tags')\n    permission_classes = [IsAuthenticated, IsOwnerOrReadOnly]\n    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]\n    filterset_class = ProductFilter\n    search_fields = ['name', 'description']\n    ordering_fields = ['price', 'created_at', 'name']\n    ordering = ['-created_at']\n\n    def get_serializer_class(self):\n        \"\"\"Return appropriate serializer based on action.\"\"\"\n        if self.action == 'create':\n            return ProductCreateSerializer\n        return ProductSerializer\n\n    def perform_create(self, serializer):\n        \"\"\"Save with user context.\"\"\"\n        serializer.save(created_by=self.request.user)\n\n    @action(detail=False, methods=['get'])\n    def featured(self, request):\n        \"\"\"Return featured products.\"\"\"\n        featured = self.queryset.filter(is_featured=True)[:10]\n        serializer = self.get_serializer(featured, many=True)\n        return Response(serializer.data)\n\n    @action(detail=True, methods=['post'])\n    def purchase(self, request, pk=None):\n        \"\"\"Purchase a product.\"\"\"\n        product = self.get_object()\n        service = ProductService()\n        result = service.purchase(product, request.user)\n        return Response(result, status=status.HTTP_201_CREATED)\n\n    @action(detail=False, methods=['get'], permission_classes=[IsAuthenticated])\n    def my_products(self, request):\n        \"\"\"Return products created by current user.\"\"\"\n        products = self.queryset.filter(created_by=request.user)\n        page = self.paginate_queryset(products)\n        serializer = self.get_serializer(page, many=True)\n        return self.get_paginated_response(serializer.data)\n```"
    },
    {
      "en-US": "### Custom Actions",
      "zh-Hans": "### 自定义操作"
    },
    {
      "en-US": "```python\nfrom rest_framework.decorators import api_view, permission_classes\nfrom rest_framework.permissions import IsAuthenticated\nfrom rest_framework.response import Response\n\n@api_view(['POST'])\n@permission_classes([IsAuthenticated])\ndef add_to_cart(request):\n    \"\"\"Add product to user cart.\"\"\"\n    product_id = request.data.get('product_id')\n    quantity = request.data.get('quantity', 1)\n\n    try:\n        product = Product.objects.get(id=product_id)\n    except Product.DoesNotExist:\n        return Response(\n            {'error': 'Product not found'},\n            status=status.HTTP_404_NOT_FOUND\n        )\n\n    cart, _ = Cart.objects.get_or_create(user=request.user)\n    CartItem.objects.create(\n        cart=cart,\n        product=product,\n        quantity=quantity\n    )\n\n    return Response({'message': 'Added to cart'}, status=status.HTTP_201_CREATED)\n```",
      "zh-Hans": "```python\nfrom rest_framework.decorators import api_view, permission_classes\nfrom rest_framework.permissions import IsAuthenticated\nfrom rest_framework.response import Response\n\n@api_view(['POST'])\n@permission_classes([IsAuthenticated])\ndef add_to_cart(request):\n    \"\"\"Add product to user cart.\"\"\"\n    product_id = request.data.get('product_id')\n    quantity = request.data.get('quantity', 1)\n\n    try:\n        product = Product.objects.get(id=product_id)\n    except Product.DoesNotExist:\n        return Response(\n            {'error': 'Product not found'},\n            status=status.HTTP_404_NOT_FOUND\n        )\n\n    cart, _ = Cart.objects.get_or_create(user=request.user)\n    CartItem.objects.create(\n        cart=cart,\n        product=product,\n        quantity=quantity\n    )\n\n    return Response({'message': 'Added to cart'}, status=status.HTTP_201_CREATED)\n```"
    },
    {
      "en-US": "## Service Layer Pattern",
      "zh-Hans": "## 服务层模式"
    },
    {
      "en-US": "```python\n# apps/orders/services.py\nfrom typing import Optional\nfrom django.db import transaction\nfrom .models import Order, OrderItem\n\nclass OrderService:\n    \"\"\"Service layer for order-related business logic.\"\"\"\n\n    @staticmethod\n    @transaction.atomic\n    def create_order(user, cart: Cart) -> Order:\n        \"\"\"Create order from cart.\"\"\"\n        order = Order.objects.create(\n            user=user,\n            total_price=cart.total_price\n        )\n\n        for item in cart.items.all():\n            OrderItem.objects.create(\n                order=order,\n                product=item.product,\n                quantity=item.quantity,\n                price=item.product.price\n            )\n\n        # Clear cart\n        cart.items.all().delete()\n\n        return order\n\n    @staticmethod\n    def process_payment(order: Order, payment_data: dict) -> bool:\n        \"\"\"Process payment for order.\"\"\"\n        # Integration with payment gateway\n        payment = PaymentGateway.charge(\n            amount=order.total_price,\n            token=payment_data['token']\n        )\n\n        if payment.success:\n            order.status = Order.Status.PAID\n            order.save()\n            # Send confirmation email\n            OrderService.send_confirmation_email(order)\n            return True\n\n        return False\n\n    @staticmethod\n    def send_confirmation_email(order: Order):\n        \"\"\"Send order confirmation email.\"\"\"\n        # Email sending logic\n        pass\n```",
      "zh-Hans": "```python\n# apps/orders/services.py\nfrom typing import Optional\nfrom django.db import transaction\nfrom .models import Order, OrderItem\n\nclass OrderService:\n    \"\"\"Service layer for order-related business logic.\"\"\"\n\n    @staticmethod\n    @transaction.atomic\n    def create_order(user, cart: Cart) -> Order:\n        \"\"\"Create order from cart.\"\"\"\n        order = Order.objects.create(\n            user=user,\n            total_price=cart.total_price\n        )\n\n        for item in cart.items.all():\n            OrderItem.objects.create(\n                order=order,\n                product=item.product,\n                quantity=item.quantity,\n                price=item.product.price\n            )\n\n        # Clear cart\n        cart.items.all().delete()\n\n        return order\n\n    @staticmethod\n    def process_payment(order: Order, payment_data: dict) -> bool:\n        \"\"\"Process payment for order.\"\"\"\n        # Integration with payment gateway\n        payment = PaymentGateway.charge(\n            amount=order.total_price,\n            token=payment_data['token']\n        )\n\n        if payment.success:\n            order.status = Order.Status.PAID\n            order.save()\n            # Send confirmation email\n            OrderService.send_confirmation_email(order)\n            return True\n\n        return False\n\n    @staticmethod\n    def send_confirmation_email(order: Order):\n        \"\"\"Send order confirmation email.\"\"\"\n        # Email sending logic\n        pass\n```"
    },
    {
      "en-US": "## Caching Strategies",
      "zh-Hans": "## 缓存策略"
    },
    {
      "en-US": "### View-Level Caching",
      "zh-Hans": "### 视图级缓存"
    },
    {
      "en-US": "```python\nfrom django.views.decorators.cache import cache_page\nfrom django.utils.decorators import method_decorator\n\n@method_decorator(cache_page(60 * 15), name='dispatch')  # 15 minutes\nclass ProductListView(generic.ListView):\n    model = Product\n    template_name = 'products/list.html'\n    context_object_name = 'products'\n```",
      "zh-Hans": "```python\nfrom django.views.decorators.cache import cache_page\nfrom django.utils.decorators import method_decorator\n\n@method_decorator(cache_page(60 * 15), name='dispatch')  # 15 minutes\nclass ProductListView(generic.ListView):\n    model = Product\n    template_name = 'products/list.html'\n    context_object_name = 'products'\n```"
    },
    {
      "en-US": "### Template Fragment Caching",
      "zh-Hans": "### 模板片段缓存"
    },
    {
      "en-US": "```django\n{% load cache %}\n{% cache 500 sidebar %}\n    ... expensive sidebar content ...\n{% endcache %}\n```",
      "zh-Hans": "```django\n{% load cache %}\n{% cache 500 sidebar %}\n    ... expensive sidebar content ...\n{% endcache %}\n```"
    },
    {
      "en-US": "### Low-Level Caching",
      "zh-Hans": "### 低级缓存"
    },
    {
      "en-US": "```python\nfrom django.core.cache import cache\n\ndef get_featured_products():\n    \"\"\"Get featured products with caching.\"\"\"\n    cache_key = 'featured_products'\n    products = cache.get(cache_key)\n\n    if products is None:\n        products = list(Product.objects.filter(is_featured=True))\n        cache.set(cache_key, products, timeout=60 * 15)  # 15 minutes\n\n    return products\n```",
      "zh-Hans": "```python\nfrom django.core.cache import cache\n\ndef get_featured_products():\n    \"\"\"Get featured products with caching.\"\"\"\n    cache_key = 'featured_products'\n    products = cache.get(cache_key)\n\n    if products is None:\n        products = list(Product.objects.filter(is_featured=True))\n        cache.set(cache_key, products, timeout=60 * 15)  # 15 minutes\n\n    return products\n```"
    },
    {
      "en-US": "### QuerySet Caching",
      "zh-Hans": "### QuerySet 缓存"
    },
    {
      "en-US": "```python\nfrom django.core.cache import cache\n\ndef get_popular_categories():\n    cache_key = 'popular_categories'\n    categories = cache.get(cache_key)\n\n    if categories is None:\n        categories = list(Category.objects.annotate(\n            product_count=Count('products')\n        ).filter(product_count__gt=10).order_by('-product_count')[:20])\n        cache.set(cache_key, categories, timeout=60 * 60)  # 1 hour\n\n    return categories\n```",
      "zh-Hans": "```python\nfrom django.core.cache import cache\n\ndef get_popular_categories():\n    cache_key = 'popular_categories'\n    categories = cache.get(cache_key)\n\n    if categories is None:\n        categories = list(Category.objects.annotate(\n            product_count=Count('products')\n        ).filter(product_count__gt=10).order_by('-product_count')[:20])\n        cache.set(cache_key, categories, timeout=60 * 60)  # 1 hour\n\n    return categories\n```"
    },
    {
      "en-US": "## Signals",
      "zh-Hans": "## 信号"
    },
    {
      "en-US": "### Signal Patterns",
      "zh-Hans": "### 信号模式"
    },
    {
      "en-US": "```python\n# apps/users/signals.py\nfrom django.db.models.signals import post_save\nfrom django.dispatch import receiver\nfrom django.contrib.auth import get_user_model\nfrom .models import Profile\n\nUser = get_user_model()\n\n@receiver(post_save, sender=User)\ndef create_user_profile(sender, instance, created, **kwargs):\n    \"\"\"Create profile when user is created.\"\"\"\n    if created:\n        Profile.objects.create(user=instance)\n\n@receiver(post_save, sender=User)\ndef save_user_profile(sender, instance, **kwargs):\n    \"\"\"Save profile when user is saved.\"\"\"\n    instance.profile.save()\n\n# apps/users/apps.py\nfrom django.apps import AppConfig\n\nclass UsersConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'apps.users'\n\n    def ready(self):\n        \"\"\"Import signals when app is ready.\"\"\"\n        import apps.users.signals\n```",
      "zh-Hans": "```python\n# apps/users/signals.py\nfrom django.db.models.signals import post_save\nfrom django.dispatch import receiver\nfrom django.contrib.auth import get_user_model\nfrom .models import Profile\n\nUser = get_user_model()\n\n@receiver(post_save, sender=User)\ndef create_user_profile(sender, instance, created, **kwargs):\n    \"\"\"Create profile when user is created.\"\"\"\n    if created:\n        Profile.objects.create(user=instance)\n\n@receiver(post_save, sender=User)\ndef save_user_profile(sender, instance, **kwargs):\n    \"\"\"Save profile when user is saved.\"\"\"\n    instance.profile.save()\n\n# apps/users/apps.py\nfrom django.apps import AppConfig\n\nclass UsersConfig(AppConfig):\n    default_auto_field = 'django.db.models.BigAutoField'\n    name = 'apps.users'\n\n    def ready(self):\n        \"\"\"Import signals when app is ready.\"\"\"\n        import apps.users.signals\n```"
    },
    {
      "en-US": "## Middleware",
      "zh-Hans": "## 中间件"
    },
    {
      "en-US": "### Custom Middleware",
      "zh-Hans": "### 自定义中间件"
    },
    {
      "en-US": "```python\n# middleware/active_user_middleware.py\nimport time\nfrom django.utils.deprecation import MiddlewareMixin\n\nclass ActiveUserMiddleware(MiddlewareMixin):\n    \"\"\"Middleware to track active users.\"\"\"\n\n    def process_request(self, request):\n        \"\"\"Process incoming request.\"\"\"\n        if request.user.is_authenticated:\n            # Update last active time\n            request.user.last_active = timezone.now()\n            request.user.save(update_fields=['last_active'])\n\nclass RequestLoggingMiddleware(MiddlewareMixin):\n    \"\"\"Middleware for logging requests.\"\"\"\n\n    def process_request(self, request):\n        \"\"\"Log request start time.\"\"\"\n        request.start_time = time.time()\n\n    def process_response(self, request, response):\n        \"\"\"Log request duration.\"\"\"\n        if hasattr(request, 'start_time'):\n            duration = time.time() - request.start_time\n            logger.info(f'{request.method} {request.path} - {response.status_code} - {duration:.3f}s')\n        return response\n```",
      "zh-Hans": "```python\n# middleware/active_user_middleware.py\nimport time\nfrom django.utils.deprecation import MiddlewareMixin\n\nclass ActiveUserMiddleware(MiddlewareMixin):\n    \"\"\"Middleware to track active users.\"\"\"\n\n    def process_request(self, request):\n        \"\"\"Process incoming request.\"\"\"\n        if request.user.is_authenticated:\n            # Update last active time\n            request.user.last_active = timezone.now()\n            request.user.save(update_fields=['last_active'])\n\nclass RequestLoggingMiddleware(MiddlewareMixin):\n    \"\"\"Middleware for logging requests.\"\"\"\n\n    def process_request(self, request):\n        \"\"\"Log request start time.\"\"\"\n        request.start_time = time.time()\n\n    def process_response(self, request, response):\n        \"\"\"Log request duration.\"\"\"\n        if hasattr(request, 'start_time'):\n            duration = time.time() - request.start_time\n            logger.info(f'{request.method} {request.path} - {response.status_code} - {duration:.3f}s')\n        return response\n```"
    },
    {
      "en-US": "## Performance Optimization",
      "zh-Hans": "## 性能优化"
    },
    {
      "en-US": "### N+1 Query Prevention",
      "zh-Hans": "### N+1 查询预防"
    },
    {
      "en-US": "```python\n# Bad - N+1 queries\nproducts = Product.objects.all()\nfor product in products:\n    print(product.category.name)  # Separate query for each product\n\n# Good - Single query with select_related\nproducts = Product.objects.select_related('category').all()\nfor product in products:\n    print(product.category.name)\n\n# Good - Prefetch for many-to-many\nproducts = Product.objects.prefetch_related('tags').all()\nfor product in products:\n    for tag in product.tags.all():\n        print(tag.name)\n```",
      "zh-Hans": "```python\n# Bad - N+1 queries\nproducts = Product.objects.all()\nfor product in products:\n    print(product.category.name)  # Separate query for each product\n\n# Good - Single query with select_related\nproducts = Product.objects.select_related('category').all()\nfor product in products:\n    print(product.category.name)\n\n# Good - Prefetch for many-to-many\nproducts = Product.objects.prefetch_related('tags').all()\nfor product in products:\n    for tag in product.tags.all():\n        print(tag.name)\n```"
    },
    {
      "en-US": "### Database Indexing",
      "zh-Hans": "### 数据库索引"
    },
    {
      "en-US": "```python\nclass Product(models.Model):\n    name = models.CharField(max_length=200, db_index=True)\n    slug = models.SlugField(unique=True)\n    category = models.ForeignKey('Category', on_delete=models.CASCADE)\n    created_at = models.DateTimeField(auto_now_add=True)\n\n    class Meta:\n        indexes = [\n            models.Index(fields=['name']),\n            models.Index(fields=['-created_at']),\n            models.Index(fields=['category', 'created_at']),\n        ]\n```",
      "zh-Hans": "```python\nclass Product(models.Model):\n    name = models.CharField(max_length=200, db_index=True)\n    slug = models.SlugField(unique=True)\n    category = models.ForeignKey('Category', on_delete=models.CASCADE)\n    created_at = models.DateTimeField(auto_now_add=True)\n\n    class Meta:\n        indexes = [\n            models.Index(fields=['name']),\n            models.Index(fields=['-created_at']),\n            models.Index(fields=['category', 'created_at']),\n        ]\n```"
    },
    {
      "en-US": "### Bulk Operations",
      "zh-Hans": "### 批量操作"
    },
    {
      "en-US": "```python\n# Bulk create\nProduct.objects.bulk_create([\n    Product(name=f'Product {i}', price=10.00)\n    for i in range(1000)\n])\n\n# Bulk update\nproducts = Product.objects.all()[:100]\nfor product in products:\n    product.is_active = True\nProduct.objects.bulk_update(products, ['is_active'])\n\n# Bulk delete\nProduct.objects.filter(stock=0).delete()\n```",
      "zh-Hans": "```python\n# Bulk create\nProduct.objects.bulk_create([\n    Product(name=f'Product {i}', price=10.00)\n    for i in range(1000)\n])\n\n# Bulk update\nproducts = Product.objects.all()[:100]\nfor product in products:\n    product.is_active = True\nProduct.objects.bulk_update(products, ['is_active'])\n\n# Bulk delete\nProduct.objects.filter(stock=0).delete()\n```"
    },
    {
      "en-US": "## Quick Reference",
      "zh-Hans": "## 快速参考"
    },
    {
      "en-US": "| Pattern | Description |\n|---------|-------------|\n| Split settings | Separate dev/prod/test settings |\n| Custom QuerySet | Reusable query methods |\n| Service Layer | Business logic separation |\n| ViewSet | REST API endpoints |\n| Serializer validation | Request/response transformation |\n| select_related | Foreign key optimization |\n| prefetch_related | Many-to-many optimization |\n| Cache first | Cache expensive operations |\n| Signals | Event-driven actions |\n| Middleware | Request/response processing |",
      "zh-Hans": "| 模式 | 描述 |\n|---------|-------------|\n| 拆分设置 | 分离开发/生产/测试设置 |\n| 自定义 QuerySet | 可重用的查询方法 |\n| 服务层 | 业务逻辑分离 |\n| ViewSet | REST API 端点 |\n| 序列化器验证 | 请求/响应转换 |\n| select\\_related | 外键优化 |\n| prefetch\\_related | 多对多优化 |\n| 缓存优先 | 缓存昂贵操作 |\n| 信号 | 事件驱动操作 |\n| 中间件 | 请求/响应处理 |"
    },
    {
      "en-US": "Remember: Django provides many shortcuts, but for production applications, structure and organization matter more than concise code. Build for maintainability.",
      "zh-Hans": "请记住：Django 提供了许多快捷方式，但对于生产应用程序来说，结构和组织比简洁的代码更重要。为可维护性而构建。"
    }
  ]
}
{
  "sourceFile": "commands/test-coverage.md",
  "sourceLanguage": "en-US",
  "entries": [
    {
      "en-US": "# Test Coverage",
      "zh-Hans": "# 测试覆盖率"
    },
    {
      "en-US": "Analyze test coverage, identify gaps, and generate missing tests to reach 80%+ coverage.",
      "zh-Hans": "分析测试覆盖率，识别缺口，并生成缺失的测试以达到 80%+ 的覆盖率。"
    },
    {
      "en-US": "## Step 1: Detect Test Framework",
      "zh-Hans": "## 步骤 1：检测测试框架"
    },
    {
      "en-US": "| Indicator | Coverage Command |\n|-----------|-----------------|\n| `jest.config.*` or `package.json` jest | `npx jest --coverage --coverageReporters=json-summary` |\n| `vitest.config.*` | `npx vitest run --coverage` |\n| `pytest.ini` / `pyproject.toml` pytest | `pytest --cov=src --cov-report=json` |\n| `Cargo.toml` | `cargo llvm-cov --json` |\n| `pom.xml` with JaCoCo | `mvn test jacoco:report` |\n| `go.mod` | `go test -coverprofile=coverage.out ./...` |",
      "zh-Hans": "| 指标 | 覆盖率命令 |\n|-----------|-----------------|\n| `jest.config.*` 或 `package.json` jest | `npx jest --coverage --coverageReporters=json-summary` |\n| `vitest.config.*` | `npx vitest run --coverage` |\n| `pytest.ini` / `pyproject.toml` pytest | `pytest --cov=src --cov-report=json` |\n| `Cargo.toml` | `cargo llvm-cov --json` |\n| `pom.xml` 与 JaCoCo | `mvn test jacoco:report` |\n| `go.mod` | `go test -coverprofile=coverage.out ./...` |"
    },
    {
      "en-US": "## Step 2: Analyze Coverage Report",
      "zh-Hans": "## 步骤 2：分析覆盖率报告"
    },
    {
      "en-US": "1. Run the coverage command\n2. Parse the output (JSON summary or terminal output)\n3. List files **below 80% coverage**, sorted worst-first\n4. For each under-covered file, identify:\n   - Untested functions or methods\n   - Missing branch coverage (if/else, switch, error paths)\n   - Dead code that inflates the denominator",
      "zh-Hans": "1. 运行覆盖率命令\n2. 解析输出（JSON 摘要或终端输出）\n3. 列出**覆盖率低于 80%** 的文件，按最差情况排序\n4. 对于每个覆盖率不足的文件，识别：\n   * 未测试的函数或方法\n   * 缺失的分支覆盖率（if/else、switch、错误路径）\n   * 增加分母的死代码"
    },
    {
      "en-US": "## Step 3: Generate Missing Tests",
      "zh-Hans": "## 步骤 3：生成缺失的测试"
    },
    {
      "en-US": "For each under-covered file, generate tests following this priority:",
      "zh-Hans": "对于每个覆盖率不足的文件，按以下优先级生成测试："
    },
    {
      "en-US": "1. **Happy path** — Core functionality with valid inputs\n2. **Error handling** — Invalid inputs, missing data, network failures\n3. **Edge cases** — Empty arrays, null/undefined, boundary values (0, -1, MAX_INT)\n4. **Branch coverage** — Each if/else, switch case, ternary",
      "zh-Hans": "1. **快乐路径** — 使用有效输入的核心功能\n2. **错误处理** — 无效输入、缺失数据、网络故障\n3. **边界情况** — 空数组、null/undefined、边界值（0、-1、MAX\\_INT）\n4. **分支覆盖率** — 每个 if/else、switch case、三元运算符"
    },
    {
      "en-US": "### Test Generation Rules",
      "zh-Hans": "### 测试生成规则"
    },
    {
      "en-US": "- Place tests adjacent to source: `foo.ts` → `foo.test.ts` (or project convention)\n- Use existing test patterns from the project (import style, assertion library, mocking approach)\n- Mock external dependencies (database, APIs, file system)\n- Each test should be independent — no shared mutable state between tests\n- Name tests descriptively: `test_create_user_with_duplicate_email_returns_409`",
      "zh-Hans": "* 将测试放在源代码旁边：`foo.ts` → `foo.test.ts`（或遵循项目惯例）\n* 使用项目中现有的测试模式（导入风格、断言库、模拟方法）\n* 模拟外部依赖项（数据库、API、文件系统）\n* 每个测试都应该是独立的 — 测试之间没有共享的可变状态\n* 描述性地命名测试：`test_create_user_with_duplicate_email_returns_409`"
    },
    {
      "en-US": "## Step 4: Verify",
      "zh-Hans": "## 步骤 4：验证"
    },
    {
      "en-US": "1. Run the full test suite — all tests must pass\n2. Re-run coverage — verify improvement\n3. If still below 80%, repeat Step 3 for remaining gaps",
      "zh-Hans": "1. 运行完整的测试套件 — 所有测试必须通过\n2. 重新运行覆盖率 — 验证改进\n3. 如果仍然低于 80%，针对剩余的缺口重复步骤 3"
    },
    {
      "en-US": "## Step 5: Report",
      "zh-Hans": "## 步骤 5：报告"
    },
    {
      "en-US": "Show before/after comparison:",
      "zh-Hans": "显示前后对比："
    },
    {
      "en-US": "```\nCoverage Report\n──────────────────────────────\nFile                   Before  After\nsrc/services/auth.ts   45%     88%\nsrc/utils/validation.ts 32%    82%\n──────────────────────────────\nOverall:               67%     84%  ✅\n```",
      "zh-Hans": "```\nCoverage Report\n──────────────────────────────\nFile                   Before  After\nsrc/services/auth.ts   45%     88%\nsrc/utils/validation.ts 32%    82%\n──────────────────────────────\nOverall:               67%     84%  ✅\n```"
    },
    {
      "en-US": "## Focus Areas",
      "zh-Hans": "## 重点关注领域"
    },
    {
      "en-US": "- Functions with complex branching (high cyclomatic complexity)\n- Error handlers and catch blocks\n- Utility functions used across the codebase\n- API endpoint handlers (request → response flow)\n- Edge cases: null, undefined, empty string, empty array, zero, negative numbers",
      "zh-Hans": "* 具有复杂分支的函数（高圈复杂度）\n* 错误处理程序和 catch 块\n* 整个代码库中使用的工具函数\n* API 端点处理程序（请求 → 响应流程）\n* 边界情况：null、undefined、空字符串、空数组、零、负数"
    }
  ]
}
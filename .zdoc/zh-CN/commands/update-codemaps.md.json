{
  "sourceFile": "commands/update-codemaps.md",
  "sourceLanguage": "en-US",
  "entries": [
    {
      "en-US": "# Update Codemaps",
      "zh-Hans": "# 更新代码地图"
    },
    {
      "en-US": "Analyze the codebase structure and generate token-lean architecture documentation.",
      "zh-Hans": "分析代码库结构并生成简洁的架构文档。"
    },
    {
      "en-US": "## Step 1: Scan Project Structure",
      "zh-Hans": "## 步骤 1：扫描项目结构"
    },
    {
      "en-US": "1. Identify the project type (monorepo, single app, library, microservice)\n2. Find all source directories (src/, lib/, app/, packages/)\n3. Map entry points (main.ts, index.ts, app.py, main.go, etc.)",
      "zh-Hans": "1. 识别项目类型（单体仓库、单应用、库、微服务）\n2. 查找所有源码目录（src/, lib/, app/, packages/）\n3. 映射入口点（main.ts, index.ts, app.py, main.go 等）"
    },
    {
      "en-US": "## Step 2: Generate Codemaps",
      "zh-Hans": "## 步骤 2：生成代码地图"
    },
    {
      "en-US": "Create or update codemaps in `docs/CODEMAPS/` (or `.reports/codemaps/`):",
      "zh-Hans": "在 `docs/CODEMAPS/`（或 `.reports/codemaps/`）中创建或更新代码地图："
    },
    {
      "en-US": "| File | Contents |\n|------|----------|\n| `architecture.md` | High-level system diagram, service boundaries, data flow |\n| `backend.md` | API routes, middleware chain, service → repository mapping |\n| `frontend.md` | Page tree, component hierarchy, state management flow |\n| `data.md` | Database tables, relationships, migration history |\n| `dependencies.md` | External services, third-party integrations, shared libraries |",
      "zh-Hans": "| 文件 | 内容 |\n|------|----------|\n| `architecture.md` | 高层系统图、服务边界、数据流 |\n| `backend.md` | API 路由、中间件链、服务 → 仓库映射 |\n| `frontend.md` | 页面树、组件层级、状态管理流 |\n| `data.md` | 数据库表、关系、迁移历史 |\n| `dependencies.md` | 外部服务、第三方集成、共享库 |"
    },
    {
      "en-US": "### Codemap Format",
      "zh-Hans": "### 代码地图格式"
    },
    {
      "en-US": "Each codemap should be token-lean — optimized for AI context consumption:",
      "zh-Hans": "每个代码地图应为简洁风格 —— 针对 AI 上下文消费进行优化："
    },
    {
      "en-US": "```markdown\n# Backend Architecture\n\n## Routes\nPOST /api/users → UserController.create → UserService.create → UserRepo.insert\nGET  /api/users/:id → UserController.get → UserService.findById → UserRepo.findById\n\n## Key Files\nsrc/services/user.ts (business logic, 120 lines)\nsrc/repos/user.ts (database access, 80 lines)\n\n## Dependencies\n- PostgreSQL (primary data store)\n- Redis (session cache, rate limiting)\n- Stripe (payment processing)\n```",
      "zh-Hans": "```markdown\n# 后端架构\n\n## 路由\nPOST /api/users → UserController.create → UserService.create → UserRepo.insert\nGET  /api/users/:id → UserController.get → UserService.findById → UserRepo.findById\n\n## 关键文件\nsrc/services/user.ts (业务逻辑，120行)\nsrc/repos/user.ts (数据库访问，80行)\n\n## 依赖项\n- PostgreSQL (主要数据存储)\n- Redis (会话缓存，速率限制)\n- Stripe (支付处理)\n```"
    },
    {
      "en-US": "## Step 3: Diff Detection",
      "zh-Hans": "## 步骤 3：差异检测"
    },
    {
      "en-US": "1. If previous codemaps exist, calculate the diff percentage\n2. If changes > 30%, show the diff and request user approval before overwriting\n3. If changes <= 30%, update in place",
      "zh-Hans": "1. 如果存在先前的代码地图，计算差异百分比\n2. 如果变更 > 30%，显示差异并在覆盖前请求用户批准\n3. 如果变更 <= 30%，则原地更新"
    },
    {
      "en-US": "## Step 4: Add Metadata",
      "zh-Hans": "## 步骤 4：添加元数据"
    },
    {
      "en-US": "Add a freshness header to each codemap:",
      "zh-Hans": "为每个代码地图添加一个新鲜度头部："
    },
    {
      "en-US": "```markdown\n<!-- Generated: 2026-02-11 | Files scanned: 142 | Token estimate: ~800 -->\n```",
      "zh-Hans": "```markdown\n<!-- Generated: 2026-02-11 | Files scanned: 142 | Token estimate: ~800 -->\n```"
    },
    {
      "en-US": "## Step 5: Save Analysis Report",
      "zh-Hans": "## 步骤 5：保存分析报告"
    },
    {
      "en-US": "Write a summary to `.reports/codemap-diff.txt`:",
      "zh-Hans": "将摘要写入 `.reports/codemap-diff.txt`："
    },
    {
      "en-US": "- Files added/removed/modified since last scan\n- New dependencies detected\n- Architecture changes (new routes, new services, etc.)\n- Staleness warnings for docs not updated in 90+ days",
      "zh-Hans": "* 自上次扫描以来添加/删除/修改的文件\n* 检测到的新依赖项\n* 架构变更（新路由、新服务等）\n* 超过 90 天未更新的文档的陈旧警告"
    },
    {
      "en-US": "## Tips",
      "zh-Hans": "## 提示"
    },
    {
      "en-US": "- Focus on **high-level structure**, not implementation details\n- Prefer **file paths and function signatures** over full code blocks\n- Keep each codemap under **1000 tokens** for efficient context loading\n- Use ASCII diagrams for data flow instead of verbose descriptions\n- Run after major feature additions or refactoring sessions",
      "zh-Hans": "* 关注**高层结构**，而非实现细节\n* 优先使用**文件路径和函数签名**，而非完整代码块\n* 为高效加载上下文，将每个代码地图保持在 **1000 个 token 以内**\n* 使用 ASCII 图表表示数据流，而非冗长的描述\n* 在主要功能添加或重构会话后运行"
    }
  ]
}
{
  "sourceFile": "commands/refactor-clean.md",
  "sourceLanguage": "en-US",
  "entries": [
    {
      "en-US": "# Refactor Clean",
      "zh-Hans": "# 重构清理"
    },
    {
      "en-US": "Safely identify and remove dead code with test verification at every step.",
      "zh-Hans": "通过测试验证安全识别和删除死代码的每一步。"
    },
    {
      "en-US": "## Step 1: Detect Dead Code",
      "zh-Hans": "## 步骤 1：检测死代码"
    },
    {
      "en-US": "Run analysis tools based on project type:",
      "zh-Hans": "根据项目类型运行分析工具："
    },
    {
      "en-US": "| Tool | What It Finds | Command |\n|------|--------------|---------|\n| knip | Unused exports, files, dependencies | `npx knip` |\n| depcheck | Unused npm dependencies | `npx depcheck` |\n| ts-prune | Unused TypeScript exports | `npx ts-prune` |\n| vulture | Unused Python code | `vulture src/` |\n| deadcode | Unused Go code | `deadcode ./...` |\n| cargo-udeps | Unused Rust dependencies | `cargo +nightly udeps` |",
      "zh-Hans": "| 工具 | 查找内容 | 命令 |\n|------|--------------|---------|\n| knip | 未使用的导出、文件、依赖项 | `npx knip` |\n| depcheck | 未使用的 npm 依赖项 | `npx depcheck` |\n| ts-prune | 未使用的 TypeScript 导出 | `npx ts-prune` |\n| vulture | 未使用的 Python 代码 | `vulture src/` |\n| deadcode | 未使用的 Go 代码 | `deadcode ./...` |\n| cargo-udeps | 未使用的 Rust 依赖项 | `cargo +nightly udeps` |"
    },
    {
      "en-US": "If no tool is available, use Grep to find exports with zero imports:",
      "zh-Hans": "如果没有可用工具，使用 Grep 查找零次导入的导出："
    },
    {
      "en-US": "```\n# Find exports, then check if they're imported anywhere\n```",
      "zh-Hans": "```\n# Find exports, then check if they're imported anywhere\n```"
    },
    {
      "en-US": "## Step 2: Categorize Findings",
      "zh-Hans": "## 步骤 2：分类发现结果"
    },
    {
      "en-US": "Sort findings into safety tiers:",
      "zh-Hans": "将发现结果按安全层级分类："
    },
    {
      "en-US": "| Tier | Examples | Action |\n|------|----------|--------|\n| **SAFE** | Unused utilities, test helpers, internal functions | Delete with confidence |\n| **CAUTION** | Components, API routes, middleware | Verify no dynamic imports or external consumers |\n| **DANGER** | Config files, entry points, type definitions | Investigate before touching |",
      "zh-Hans": "| 层级 | 示例 | 操作 |\n|------|----------|--------|\n| **安全** | 未使用的工具函数、测试辅助函数、内部函数 | 放心删除 |\n| **谨慎** | 组件、API 路由、中间件 | 验证没有动态导入或外部使用者 |\n| **危险** | 配置文件、入口点、类型定义 | 在操作前仔细调查 |"
    },
    {
      "en-US": "## Step 3: Safe Deletion Loop",
      "zh-Hans": "## 步骤 3：安全删除循环"
    },
    {
      "en-US": "For each SAFE item:",
      "zh-Hans": "对于每个 **安全** 项："
    },
    {
      "en-US": "1. **Run full test suite** — Establish baseline (all green)\n2. **Delete the dead code** — Use Edit tool for surgical removal\n3. **Re-run test suite** — Verify nothing broke\n4. **If tests fail** — Immediately revert with `git checkout -- <file>` and skip this item\n5. **If tests pass** — Move to next item",
      "zh-Hans": "1. **运行完整测试套件** — 建立基准（全部通过）\n2. **删除死代码** — 使用编辑工具进行精确删除\n3. **重新运行测试套件** — 验证没有破坏任何功能\n4. **如果测试失败** — 立即使用 `git checkout -- <file>` 回滚并跳过此项\n5. **如果测试通过** — 处理下一项"
    },
    {
      "en-US": "## Step 4: Handle CAUTION Items",
      "zh-Hans": "## 步骤 4：处理谨慎项"
    },
    {
      "en-US": "Before deleting CAUTION items:",
      "zh-Hans": "在删除 **谨慎** 项之前："
    },
    {
      "en-US": "- Search for dynamic imports: `import()`, `require()`, `__import__`\n- Search for string references: route names, component names in configs\n- Check if exported from a public package API\n- Verify no external consumers (check dependents if published)",
      "zh-Hans": "* 搜索动态导入：`import()`、`require()`、`__import__`\n* 搜索字符串引用：配置中的路由名称、组件名称\n* 检查是否从公共包 API 导出\n* 验证没有外部使用者（如果已发布，请检查依赖项）"
    },
    {
      "en-US": "## Step 5: Consolidate Duplicates",
      "zh-Hans": "## 步骤 5：合并重复项"
    },
    {
      "en-US": "After removing dead code, look for:",
      "zh-Hans": "删除死代码后，查找："
    },
    {
      "en-US": "- Near-duplicate functions (>80% similar) — merge into one\n- Redundant type definitions — consolidate\n- Wrapper functions that add no value — inline them\n- Re-exports that serve no purpose — remove indirection",
      "zh-Hans": "* 近似的重复函数（>80% 相似）— 合并为一个\n* 冗余的类型定义 — 整合\n* 没有增加价值的包装函数 — 内联它们\n* 没有作用的重新导出 — 移除间接引用"
    },
    {
      "en-US": "## Step 6: Summary",
      "zh-Hans": "## 步骤 6：总结"
    },
    {
      "en-US": "Report results:",
      "zh-Hans": "报告结果："
    },
    {
      "en-US": "```\nDead Code Cleanup\n──────────────────────────────\nDeleted:   12 unused functions\n           3 unused files\n           5 unused dependencies\nSkipped:   2 items (tests failed)\nSaved:     ~450 lines removed\n──────────────────────────────\nAll tests passing ✅\n```",
      "zh-Hans": "```\nDead Code Cleanup\n──────────────────────────────\nDeleted:   12 unused functions\n           3 unused files\n           5 unused dependencies\nSkipped:   2 items (tests failed)\nSaved:     ~450 lines removed\n──────────────────────────────\nAll tests passing ✅\n```"
    },
    {
      "en-US": "## Rules",
      "zh-Hans": "## 规则"
    },
    {
      "en-US": "- **Never delete without running tests first**\n- **One deletion at a time** — Atomic changes make rollback easy\n- **Skip if uncertain** — Better to keep dead code than break production\n- **Don't refactor while cleaning** — Separate concerns (clean first, refactor later)",
      "zh-Hans": "* **切勿在不先运行测试的情况下删除代码**\n* **一次只删除一个** — 原子化的变更便于回滚\n* **如果不确定就跳过** — 保留死代码总比破坏生产环境好\n* **清理时不要重构** — 分离关注点（先清理，后重构）"
    }
  ]
}